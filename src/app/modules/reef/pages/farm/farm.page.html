<ng-container *ngIf="!(loading$ | async); else loadingTemplate">
  <ng-container *ngIf="address$ | async as address; else errorTemplate">
    <ng-container *ngIf="lpContract$ | async as contract">
      <ng-container *ngIf="tokenBalance$ | async as tokenBalance">
        <ng-container *ngIf="tokenSymbol$ | async as token">
          <div class="row">
            <div class="col">
              <app-page-title
                title="Farm"
                [subtitle]="'Stake your UNI-V2 LP Tokens in the '+getSubtitleTokenPart(token)+' pool to earn REEF!'"
              ></app-page-title>
            </div>
          </div>
          <div class="page__wrapper row">
            <div class="col-12">
              <div class="card align-items-center">
                <div class="card-body max-w-500">
                  <!--<div class="d-flex align-items-center justify-content-center mb-3">
                    [
                    <ng-container *ngIf="token !== 'TOKEN'">{{ token }} â€“</ng-container>
                    REEF]
                  </div>-->
                  <div class="d-flex align-items-center justify-content-center mb-4">
                    <img
                      *ngIf="token !== 'TOKEN'"
                      class="img-size-top-60"
                      src="../../../../../assets/images/{{ token === 'WETH' ? 'eth.png' : 'usdt.png' }}"
                      alt="alt-token">
                    <img
                      class="img-size-top-60"
                      src="../../../../../assets/images/reef/reef-token.svg" alt="reef-token">
                  </div>
                  <!--<div
                    class="d-flex flex-column align-items-center justify-content-center mb-4">
                    <div class="text-monospace text-muted small text-center mb-2">
                      Stake your
                      <strong class="font-weight-bold">UNI-V2 LP Tokens</strong>
                      in the
                      <strong class="font-weight-bold"><span *ngIf="token !== 'TOKEN'">{{ token }}/</span>REEF</strong>
                      pool to earn REEF!
                    </div>
                  </div>-->
                  <div class="row">
                    <div class="mb-4 col">
                      <div class="card bg-purple text-white p-05 height-100 text-monospace justify-content-center">
                        <div class="small mb-1 text-center">
                          Pool APY
                        </div>
                        <div
                          class="small text-center">
                    <span class="font-weight-bold text-center">
                      {{ apy | number }} %
                    </span>
                        </div>
                      </div>
                    </div>
                    <div class="mb-4 col">
                      <div class="card bg-purple text-white p-05 height-100 text-monospace justify-content-center">
                      <div class="small mb-1 text-center">
                        Staked LP Tokens
                      </div>
                      <div
                        *ngIf="stakedAmount$ | async as staked"
                        class="small text-center">
                    <span class="font-weight-bold">
                      {{ staked | number }} {{ token !== 'TOKEN' ? ' LP Tokens' : 'REEF' }}
                    </span>
                      </div>
                      </div>
                    </div>
                    <div class="mb-4 col">
                      <div class="card bg-purple text-white p-05 height-100 text-monospace justify-content-center">
                      <div class="small mb-1 text-center ">
                        Pending REWARD
                      </div>
                      <div
                        *ngIf="reefReward$ | async as pendingReef"
                        class="small text-center">
                    <span class="font-weight-bold">
                      {{ pendingReef | number:'1.0-0' }} REEF
                    </span>
                      </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="col-sm-12 col-md-8 offset-md-2 max-w-xs flex-column mb-4 text-muted">
                    <div class="d-flex justify-content-start align-items-center mb-2">
                      <div class="small  align-self-start mr-1">
                        {{ token !== 'TOKEN' ? 'LP Tokens' : 'REEF' }} amount
                      </div>
                    </div>
                    <input
                      [(ngModel)]="reefAmount"
                      class="form-control small accent-text"
                      id="reefAmount"
                      placeholder="0.0" type="number"/>
                    <ng-container *ngIf="+reefAmount <= tokenBalance; else noBalance">
                      <app-set-input-relative-amount
                        [value]="tokenBalance"
                        [tokenSymbol]="token !== 'TOKEN' ? 'LP Tokens' : 'REEF'"
                        (valueChange)="reefAmount=$event"
                        (refreshBalance)="refreshBalance(contract,address)"
                      ></app-set-input-relative-amount>
                    </ng-container>
                    <ng-template #noBalance>
                      <div class="small text-center mt-1">
                        <span class="text-danger">
                          Insufficient REEF-{{token}} LP Tokens
                        </span>
                      </div>
                    </ng-template>
                  </div>
                  <div
                    *ngIf="!loading"
                    class="row">
                    <div class="col text-center grid-col-m-bottom">
                      <button
                        [disabled]="!reefAmount ||
                            reefAmount > tokenBalance || reefAmount <= 0"
                        (click)="deposit(contract, address, reefAmount.toString(10))" class="btn btn-primary">
                        Deposit <br>Tokens
                      </button>
                    </div>
                    <div *ngIf="stakedAmount$ | async as staked" class="text-center col grid-col-m-bottom">
                      <button
                        [disabled]="staked <= 0"
                        (click)="withdraw(address, reefAmount)" class="btn btn-primary">
                        Withdraw <br>Funds
                      </button>
                    </div>
                    <div *ngIf="reefReward$ | async as reward" class="text-center col grid-col-m-bottom">
                      <button
                        [disabled]="reward <= 0"
                        (click)="withdraw(address, 0)" class="btn btn-primary">
                        Harvest <br>Tokens
                      </button>
                    </div>
                  </div>
                  <div class="d-flex align-items-center justify-content-around">
                    <app-loading *ngIf="loading" diameter="25"></app-loading>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>

<ng-template #errorTemplate>
  <app-empty-state
    title="Wrong address"
    subtitle="You have the wrong address, or we do not support that pool currently.">
  </app-empty-state>
</ng-template>

<ng-template #loadingTemplate>
  <app-loading [isWholePage]="true"></app-loading>
</ng-template>


<!--<input-->
<!--  #reefAmount-->
<!--  placeholder="Stake LP" type="number">-->
<!--<button (click)="deposit(contract, address, amount.value)">Stake</button>-->
<!--<button (click)="withdraw(address, amount.value)">Withdraw</button>-->
<!--<button (click)="withdraw(address, 0)">Harvest</button>-->
